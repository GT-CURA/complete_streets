# Manual Sidewalk Width Annotation Tool

## üìç Objective
Our automated pipeline estimates sidewalk width from Google Street View imagery using semantic segmentation and geometric reasoning. In many cases it works well, but it can fail when:
- The sidewalk is very close or very far from the camera  
- The viewpoint is misaligned with the roadway  
- There is strong occlusion (cars, vegetation, pedestrians, etc.)  
- Lighting / shadows are extreme  
- Driveways / parking lots look similar to sidewalks  
- The segmentation model simply makes mistakes  

<br>

Because we don't have a perfect segmentation model (and can't handle every issue automatically), this tool provides a **Jupyter-based manual annotation interface** to implement ~~~ where a human can:
- Inspect the street view imagery collected by the automated tool  
- Move forward/backward along the road segment to find a better image
- Zoom in / out to better see sidewalk edges  
- Manually mark **top** and **bottom** sidewalk edges in two images (pitch 0¬∞ and pitch ‚àí10¬∞)  
- Mark a location as **‚ÄúNo Sidewalk‚Äù** when appropriate  

From those clicks, the tool computes an **estimated sidewalk width** using a two-pitch geometric model and saves everything to a CSV.

### Input:
- A GeoJSON file of road segment points.
- CSV files that store the estimated sidewalk width by automated tool

### Process:
  1. Looking all the CSV files generated by automation tool, Figures out the points that do not have valid estimated width based on the results generated by an automation tool.
  2. Loads the orignally downloaded images for a given case.
  3. Decide whether there is a need to move the image capture point or zoom in / out the image.
  4. Manually mark the top and bottom edges of the sidewalk visible in an imagery.

### Output:**  
  - A CSV file for each input point containing the estimated `width` and the point coordinates you marked as the edges. 
  - All newly downloaded images are saved locally in the `/outputs` directory.


## üì¶ Features:
- **`POINT_EPSG4326.geojson`**
  Example input file (5 sample points in Atlanta). Replace with your own points of interest.
  
- **Jupyter Lab Scripts (.ipynb)** 
  1. **0_filter.ipynb**: Find the cases that are appeared to have invalid result (NaN case under widht or extraordinary short or long width) 
  2. **1_manual_annotation.ipynb**: Jupyter-lab based interface tool that allows you to do diverse actions to generate an appropriate image containing visible sidewalk and label the edges

- **`/outputs`**
  Directory containing downloaded images and a CSV file for each input point containing the estimated width.

## üöó Quick Guide
conda create -n sidewalk_manual python=3.10 -y
conda activate sidewalk_manual
conda install -c conda-forge numpy pandas geopandas scipy requests pillow ipywidgets ipyevents jupyterlab -y
pip install ipywidgets jupyterlab_widgets
python -m ipykernel install --user --name sidewalk_manual --display-name "sidewalk_manual"

1. **Install Conda Environment**
  ```bash
  conda create -n sidewalk_manual python=3.10 -y
  conda activate sidewalk_manual
  conda install -c conda-forge numpy pandas geopandas scipy requests pillow ipywidgets ipyevents jupyterlab -y
  pip install ipywidgets jupyterlab_widgets
  python -m ipykernel install --user --name sidewalk_manual --display-name "sidewalk_manual"
  ```

2. **Run 0_filter.ipynb**
Open Jupyter lab
  ```bash
  jupyter lab
  ```
Run 0_filter.ipynb. This script classiifes the outputs generated by automation tool into two categories: valid and invalid. Valid cases are where the width are measured and range is acceptable. Invalid cases are those do not belong to that range or NaN value (fail to calculate the width due to several reasons). Range depends on geographical context, but typically setting 1.0 meter to 5.0 meter is acceptable.

3. **Run 1_manual_annotation.ipynb**
In the first block, there are configurations we need to set up correctly
- d

Then, run the second block, which will shows you an interface tool to allow you to
- ~~~ 
- Change image capture point by moving forward or backward
- Zoom in or out an image
- Mark "No Sidewalk"
- Undo your action
- Reset the marked points

### References
If you use this model, please cite the following paper: 

```bibtex
@article{your_article,
  title   = {A novel approach for estimating sidewalk width from street view images and computer vision},
  author  = {Lieu, S. J., & Guhathakurta, S.},
  journal = {Environment and Planning B: Urban Analytics and City Science},
  year    = {2025}
}
